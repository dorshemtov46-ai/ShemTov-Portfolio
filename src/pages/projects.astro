---
import Base from "../layouts/Base.astro";
import { getAllProjects } from "../lib/projects";

// Load all project content
const all = getAllProjects();

// Sorting rules:
// 1. Non-systems first
// 2. Systems last
// 3. Inside each group: sort by date (newest → oldest)
const projects = all.sort((a, b) => {
  const aIsSystem = a.type === "system";
  const bIsSystem = b.type === "system";

  // SYSTEMS GO LAST
  if (aIsSystem && !bIsSystem) return 1;
  if (!aIsSystem && bIsSystem) return -1;

  // Within each group: newest first
  return new Date(b.date) - new Date(a.date);
});
---

<Base title="Projects — Dor Shem Tov">
  <section class="mt-4 mb-10 max-w-3xl">
    <h1 class="text-3xl font-bold mb-3">All Projects</h1>
    <p class="text-neutral-300 leading-relaxed">
    </p>
  </section>

  <section>
    <div class="grid sm:grid-cols-2 lg:grid-cols-3 gap-8">
      {projects.map(p => (
        <a class="card block" href={`/projects/${p.slug}/`}>
          <img
            src={p.cover}
            alt={p.title}
            class="rounded-xl mb-3 w-full h-44 object-cover"
            loading="lazy"
          />

          <h3 class="text-lg font-semibold">{p.title}</h3>
          <p class="text-sm opacity-80 mb-2">{p.summary}</p>

          <div class="flex flex-wrap gap-2">
            {p.tags?.map(t => <span class="tag">{t}</span>)}
          </div>
        </a>
      ))}
    </div>
  </section>
</Base>
