---
import Base from "../layouts/Base.astro";
import { getAllProjects } from "../lib/projects";

// Load all projects
const allProjects = getAllProjects();

// Desired manual order by SLUG (not title)
const ORDER_SLUGS: string[] = [
  "warriors-merge",
  "ice-slingers",
  "orbit-defense",
  "castle-force-td",
  "peg-slinger",
  "super-strike",
  "chaos-squad",
  "slime-hunt",
  "survive-the-void",
  "mr-gish",
  "devoured",
  "a-way-back",
  "iris",
  "vertical-slice",
  "bound-survivors",
];

// Sorting logic to follow your list exactly
const projectsOrdered = [...allProjects].sort((a, b) => {
  const ia = ORDER_SLUGS.indexOf(a.slug);
  const ib = ORDER_SLUGS.indexOf(b.slug);

  const aIn = ia !== -1;
  const bIn = ib !== -1;

  // If BOTH are in the list → compare indices
  if (aIn && bIn) return ia - ib;

  // If only A is in the list → A comes first
  if (aIn && !bIn) return -1;

  // If only B is in the list → B comes first
  if (!aIn && bIn) return 1;

  // If neither is in the list → fallback alphabetical by title
  return a.title.localeCompare(b.title);
});
---

<Base title="All Projects — Dor Shem Tov">

  <section class="space-y-6">
    <header class="space-y-2">
      <h1 class="text-3xl sm:text-4xl font-bold">All Projects</h1>
      <p class="text-sm sm:text-base text-neutral-300 max-w-2xl">
        A collection of prototypes, production games, and design experiments,
        ordered manually to highlight key projects first.
      </p>
    </header>

    {projectsOrdered.length === 0 ? (
      <p class="text-sm text-neutral-400">
        No projects found. Add Markdown files in <code>src/content/projects</code>.
      </p>
    ) : (
      <div class="grid sm:grid-cols-2 lg:grid-cols-3 gap-6 mt-4">
        {projectsOrdered.map((p) => (
          <a class="card block" href={`/projects/${p.slug}/`}>
            <img
              src={p.cover ?? "/images/hero-placeholder.svg"}
              alt={p.title}
              class="rounded-xl mb-3 w-full h-44 object-cover"
              loading="lazy"
            />
            <h2 class="text-lg font-semibold">{p.title}</h2>
            <p class="text-sm opacity-80">{p.summary}</p>

            {p.tags && p.tags.length > 0 && (
              <div class="mt-3 flex flex-wrap gap-2">
                {p.tags.map((t) => (
                  <span class="tag">{t}</span>
                ))}
              </div>
            )}
          </a>
        ))}
      </div>
    )}
  </section>

</Base>
